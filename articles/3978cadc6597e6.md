---
title: 'ã€React/Next.jsã€‘Reactã§Gemini APIã‚’å©ãå‰ã«çŸ¥ã£ã¦ãŠããŸã„HTTPé€šä¿¡ã®åŸºç¤'
emoji: 'ğŸ¤–'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [typescript, gemini, javascript, api]
published: true
---

## ã¯ã˜ã‚ã«

Gemini APIã‚’ä½¿ã„ã€è‹±èªå•é¡Œã‚’ä½œæˆã—ã¦ãã‚Œã‚‹ã‚¢ãƒ—ãƒªé–‹ç™ºã‚’é€šã—ã¦å­¦ã‚“ã ã€APIé€£æºæ–¹æ³•ã¨ã©ã†ã„ã£ãŸãƒ­ã‚¸ãƒƒã‚¯ã‚’ãªãœãã®ã‚ˆã†ã«æ›¸ãã®ã‹ã‚’åŸºç¤æ¦‚å¿µã«è§¦ã‚ŒãªãŒã‚‰å…±æœ‰ã—ã¦ã„ãã¾ã™ã€‚

é–‹ç™ºç’°å¢ƒã¯TypeScript, Next.js v16, React v19ã«ãªã‚Šã¾ã™ã€‚

**ã“ã®è¨˜äº‹ã§ã¯APIã‚’å©ã„ã¦ã€è¿”ã£ã¦ããŸãƒ‡ãƒ¼ã‚¿ã‚’console.logã§è¡¨ç¤ºã™ã‚‹ã¾ã§ã®éç¨‹ã‚’å…±æœ‰ã—ã¾ã™ã€‚**

ä»¥ä¸‹ã®ã“ã¨ãŒã“ã®è¨˜äº‹ã‹ã‚‰å­¦ã¹ã¾ã™ã€‚

- HTTPé€šä¿¡ã®åŸºç¤ã«åŸºã¥ã„ãŸã€APIã¸ã®ç†è§£
- Gemini APIé€£æº

:::message alert
**æ³¨æ„ç‚¹**
Next.jsã¨TypeScriptã‚’ä½¿ã£ã¦ã„ã¾ã™ãŒã€åŸºç¤æ¦‚å¿µã‚’é‡è¦–ã—ãŸè§£èª¬ã®ãŸã‚è¨€èªç‰¹æœ‰ã®çŸ¥è­˜ãªã©ã¯è§¦ã‚Œãªã„ã§ã™ã€‚
:::

## HTTPé€šä¿¡ã®åŸºç¤

### fetchã¨ã¯

fetchã¯HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç™ºè¡Œã™ã‚‹é–¢æ•°ã§ã€GETãƒ»POSTãªã©ã®HTTPé€šä¿¡ã‚’è¡Œã†ã‚‚ã®ã§ã™ã€‚
ä¸€èˆ¬çš„ã«ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¨Node.jsã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™ã€‚
é‡è¦äº‹é …ã¨ã—ã¦ã€Promiseã‚’è¿”ã™ã®ã§ã€awaitã§çµæœã‚’å¾…ã¡ã¾ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ ã‚µãƒ¼ãƒãƒ¼: **Request**
ã‚µãƒ¼ãƒãƒ¼ â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ: **Response**

| æ–¹å‘      | ä½•ã«å…¥ã£ã¦ã„ã‚‹   | å–ã‚Šå‡ºã—æ–¹                       |
| --------- | ---------------- | -------------------------------- |
| é€ä¿¡ï¼ˆâ†’ï¼‰ | Request ã® body  | ã‚µãƒ¼ãƒãƒ¼ã§ `request.json()`      |
| å—ä¿¡ï¼ˆâ†ï¼‰ | Response ã® body | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ `response.json()` |

### Request ã¨ Response

- **Request** = ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã‚µãƒ¼ãƒãƒ¼ã¸é€ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- **Response** = ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸è¿”ã™ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

ã©ã¡ã‚‰ã‚‚ headersï¼ˆãƒ¡ã‚¿æƒ…å ±ï¼‰ã¨ bodyï¼ˆå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ï¼‰ã‚’æŒã¡ã¾ã™ã€‚
:::message
**å‚è€ƒè¨˜äº‹**
[[Deno] Webæ¨™æº–Responseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§æ§˜ã€…ãªãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šå–ã‚Šã™ã‚‹](https://qiita.com/access3151fq/items/08fe6a9554a6f2f38fed)

[JavaScriptã®Fetch API ã«ã¤ã„ã¦](https://qiita.com/sotasato/items/31be24d6776f3232c0c0)
:::

## React(JavaScript)ã¨HTTPé€šä¿¡

ä¸»ã«ã€2æ®µéšã®å‡¦ç†ã‚’æŒŸã¿ã¾ã™ã€‚æœ€åˆãŒReactã§Gemini APIã¨é€£æºã—ã¦APIã‚’å©ãã¨ãã€é‡è¦ãªã®ã¯Stateã§ç®¡ç†ã—ã¦ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã«æ•´å½¢ã—ã€Requestã®bodyã«è¼‰ã›ã¦ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã«é€ã‚‹ã€‚
æœ€å¾ŒãŒã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ•´å½¢ã—ã¦ã‹ã‚‰Gemini APIã‚’å©ãã§ã™ã€‚

```
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ]
state â†’ JSON.stringify â†’ fetch(body) â†’

[ã‚µãƒ¼ãƒãƒ¼]
â†’ request.json() â†’ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ•´å½¢ â†’ Gemini API
```

## Gemini APIé€£æº

ä»Šå›ã®APIã®ä½¿ã„æ–¹ã®æµã‚Œã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```
APIã‚­ãƒ¼ç™ºè¡Œ -> .env.localãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚­ãƒ¼ã‚’ä¿æŒ -> route.tsã§keyã‚’ä½¿ã„ãƒ­ã‚¸ãƒƒã‚¯å‡¦ç†
```

:::message
**æ³¨æ„**
ç’°å¢ƒå¤‰æ•°ã« `NEXT_PUBLIC_` ã‚’ã¤ã‘ã‚‹ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã«éœ²å‡ºã—ã¦ã—ã¾ã„ã¾ã™ï¼
APIã‚­ãƒ¼ã¯ç§˜å¯†æƒ…å ±ãªã®ã§ã€ã¤ã‘ãªã„ã§ãã ã•ã„ï¼

ã¾ãŸã€`.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ãã“ã«APIã‚­ãƒ¼ã‚’æ›¸ãã“ã¨ã‚’ãŠã™ã™ã‚ã§ã™ã€‚
ç†ç”±ã¯ã€Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œãšã€APIã‚­ãƒ¼ãŒæ¼ã‚Œãªã„ã‹ã‚‰ã§ã™ã€‚
:::

### ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆRoute Handlerï¼‰

```typescript:app\api\gemini\route.ts
import { GoogleGenAI } from '@google/genai';
import { NextResponse } from 'next/server';

const gemini = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY });

export async function POST(request: Request) {
//   ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‹ã‚‰æ¥ãŸjsonãƒ‡ãƒ¼ã‚¿ã‚’è§£æã—ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ•´å½¢ã—ã¾ã™ã€‚
  const body = await request.json();
  const { targetScore, questionType, option } = body;

  const prompt = `
      TOEIC ${targetScore}ç‚¹ãƒ¬ãƒ™ãƒ«ã®${questionType}å•é¡Œã‚’1å•ä½œæˆã—ã¦ãã ã•ã„ã€‚
      ${option ? `ã€Œ${option}ã€ã¨ã„ã†å˜èªã‚’å«ã‚ã¦ãã ã•ã„ã€‚` : ''}

      ä»¥ä¸‹ã®å½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
      å•é¡Œæ–‡:
      é¸æŠè‚¢:
      A)
      B)
      C)
      D)
      æ­£è§£:
    `;

//   ä½¿ã„ãŸã„Geminiã®ãƒ¢ãƒ‡ãƒ«ã‚’æŒ‡å®šã—ã€æ¸¡ã—ãŸã„å†…å®¹ã‚’contentsãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«è¼‰ã›ã¦APIã‹ã‚‰è¿”ã£ã¦ããŸãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¾ã™ã€‚
  const response = await gemini.models.generateContent({
    model: 'gemini-2.5-flash',
    contents: prompt,
  });

  return NextResponse.json({
    question: response.text,
  });
}
```

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´

```typescript:app\page.tsx
"use client";

import { useState } from "react";
import QuestionModal from "@/components/QuestionModal";

export default function Home() {
  const [isModalOpen, setIsModalOpen] = useState(false);

  return (
    <main className="min-h-screen bg-gray-50 flex flex-col items-center justify-center p-6 text-center">
      <div className="space-y-4 mb-12">
        <h1 className="text-5xl font-black text-gray-900 tracking-tighter">
          TOEIC
        </h1>
        <p className="text-gray-500 max-w-sm mx-auto font-medium">
          ã‚ãªãŸã®ç›®æ¨™ã‚¹ã‚³ã‚¢ã«åˆã‚ã›ãŸå•é¡Œã‚’ã€GeminiãŒç¬æ™‚ã«ä½œæˆã—ã¾ã™ã€‚
        </p>
      </div>

      <button
        onClick={() => setIsModalOpen(true)}
        className="group relative px-12 py-6 bg-white rounded-3xl shadow-2xl hover:shadow-indigo-100 transition-all active:scale-95 border border-gray-100"
      >
        <span className="text-xl font-bold text-gray-800">å•é¡Œã‚’æ–°è¦ä½œæˆ</span>
      </button>

      <QuestionModal
        isOpen={isModalOpen}
        onClose={() => setIsModalOpen(false)}
      />
    </main>
  );
}
```

```typescript:components\QuestionModal.tsx
"use client";

import { QUESTION_TYPE_LABELS, QUESTION_TYPES, QuestionForm, TARGET_SCORE_LABELS, TARGET_SCORES } from "@/types/schema";
import { useState } from "react";

interface QuestionModalProps {
    isOpen: boolean;
    onClose: () => void;
}

export default function QuestionModal({ isOpen, onClose }: QuestionModalProps) {
    const [form, setForm] = useState<QuestionForm>({
        targetScore: '200',
        questionType: 'random',
        option: '',
    })

  if (!isOpen) return null;

  const handleSubmit = async () => {
    // Stateã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã§ã‚µãƒ¼ãƒãƒ¼å´ã«é€ä¿¡
    const response = await fetch('/api/gemini', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(form),
    });

    // ã‚µãƒ¼ãƒãƒ¼å´ã‹ã‚‰è¿”ã£ã¦ããŸJSONãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™
    const data = await response.json();
    console.log(data.question);
  }

  return (
   <div className="fixed inset-0 flex items-center justify-center p-4">
    <div className="absolute inset-0" onClick={onClose} />
     <div className="relative bg-white w-full max-w-xl rounded-[2.5rem] shadow-2xl overflow-hidden">
       <div className="p-8">
        <h2 className="text-2xl font-black text-gray-900 mb-8 tracking-tight">ã©ã‚“ãªå•é¡Œã«ã—ã¾ã™ã‹ï¼Ÿ</h2>
         <div className="space-y-10">
            <section>
                <label className="text-md font-black text-cyan-700 uppercase tracking-[0.2em] ml-1 mb-3 block">ç›®æ¨™ã‚¹ã‚³ã‚¢</label>
                <div className="grid grid-cols-4 gap-2">
                    {TARGET_SCORES.map((score) => (
                        <button
                          key={score}
                          className={`py-3 rounded-2xl font-bold text-sm border-2 transition-all ${
                            form.targetScore === score
                            ? "bg-cyan-600 border-cyan-600 text-white shadow-lg shadow-cyan-200"
                            : "bg-gray-50 border-transparent text-gray-400 hover:bg-gray-100 disabled:opacity-50"
                            }`}
                          onClick={() => setForm({...form, targetScore: score})}
                        >
                            {TARGET_SCORE_LABELS[score]}
                        </button>
                    ))}
                </div>
            </section>
            <section>
                <label className="text-md font-black text-cyan-700 uppercase tracking-[0.2em] ml-1 mb-3 block">å•é¡Œã‚¿ã‚¤ãƒ—</label>
                <div className="grid grid-cols-4 gap-2">
                    {QUESTION_TYPES.map((question) => (
                        <button
                          key={question}
                          className={`py-3 rounded-2xl font-bold text-sm border-2 transition-all ${
                            form.questionType === question
                            ? "bg-cyan-600 border-cyan-600 text-white shadow-lg shadow-cyan-200"
                            : "bg-gray-50 border-transparent text-gray-400 hover:bg-gray-100 disabled:opacity-50"
                         }`}
                          onClick={() => setForm({...form, questionType: question})}
                        >
                            {QUESTION_TYPE_LABELS[question]}
                        </button>
                    ))}
                </div>
            </section>
            <section>
                <label htmlFor="option" className="text-md font-black text-cyan-700 uppercase tracking-[0.2em] ml-1 mb-3 block">å•é¡Œã«å…¥ã‚ŒãŸã„å˜èª</label>
                <input
                  type="text"
                  id="option"
                  onChange={(e) => setForm({...form, option: e.target.value})}
                  className="w-full px-6 py-4 bg-gray-50 border-2 border-transparent rounded-[1.5rem] text-gray-700 font-bold placeholder-gray-300 focus:bg-white focus:border-cyan-600 focus:ring-0 outline-none transition-all shadow-sm" placeholder="Hello World" required />
            </section>
            <div className="flex gap-3 mt-6">
                <button
                    onClick={onClose}
                    className="flex-1 px-4 py-2 text-sm font-black text-cyan-700 uppercase tracking-[0.2em] ml-1 mb-3 block rounded-lg border border-gray-300 text-gray-600 bg-white hover:bg-gray-100 transition-all active:scale-95"
                >
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>

                <button
                    onClick={handleSubmit}
                    className="flex-[2.5] px-4 py-2 text-sm font-black text-cyan-700 uppercase tracking-[0.2em] ml-1 mb-3 block rounded-lg bg-cyan-600 text-white hover:bg-cyan-700 shadow-md transition-all active:scale-[0.98] active:shadow-inner active:translate-y-0.5"
                >
                    ä½œæˆ
                </button>
            </div>
         </div>
       </div>
     </div>
   </div>
  );
}
```

### ãƒ‡ãƒ¼ã‚¿å‹æŒ‡å®š

```typescript:src\types\schema.ts
// å•é¡Œã‚¿ã‚¤ãƒ—
export const QUESTION_TYPES = ['fill_in_the_blank', 'scramble', 'translation', 'synonym', 'preposition', 'insertion', 'paraphrase', 'random'] as const;

export type QuestionType = (typeof QUESTION_TYPES)[number];

export const QUESTION_TYPE_LABELS: Record<QuestionType, string> = {
  fill_in_the_blank: 'ç©´åŸ‹ã‚',
  scramble: 'ä¸¦ã³æ›¿ãˆ',
  translation: 'ç¿»è¨³',
  synonym: 'é¡ç¾©èª',
  preposition: 'å‰ç½®è©',
  insertion: 'æ–‡æŒ¿å…¥',
  paraphrase: 'è¨€ã„æ›ãˆ',
  random: 'ãƒ©ãƒ³ãƒ€ãƒ ',
};

// ç›®æ¨™ç‚¹æ•°
export const TARGET_SCORES = ['200', '300', '400', '500', '600', '700', '800', '900'] as const;

export type TargetScore = (typeof TARGET_SCORES)[number];

export const TARGET_SCORE_LABELS: Record<TargetScore, string> = {
  '200': '200ç‚¹',
  '300': '300ç‚¹',
  '400': '400ç‚¹',
  '500': '500ç‚¹',
  '600': '600ç‚¹',
  '700': '700ç‚¹',
  '800': '800ç‚¹',
  '900': '900ç‚¹',
};

//å•é¡Œãƒ•ã‚©ãƒ¼ãƒ 
export interface QuestionForm {
    targetScore: TargetScore;
    questionType: QuestionType;
    option?: string;
}
```

:::message
**å‚è€ƒè¨˜äº‹**
é…åˆ—ã‹ã‚‰Unionå‹ã‚’ä½œæˆã—ã¦ã€Recordå‹ã«ã—ã¦ã‚‹æ„å‘³ãŒã‚ã‹ã‚Šã«ãã„å ´åˆã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦æ¬²ã—ã„ã§ã™ã€‚
[ã€TypeScriptã€‘é…åˆ—ã‹ã‚‰Unionå‹ã‚’ç”Ÿæˆã—ã¦ã€å‹å®‰å…¨ãªã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’å®Ÿè£…](https://zenn.dev/soma2367/articles/3b098df21cc962)
:::

## ã¾ã¨ã‚

ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã®æµã‚Œã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```
[ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ]          [route.ts]              [Gemini]
     |                        |                      |
     | â‘  fetch(é€ä¿¡)          |                      |
     | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> |                      |
     |                        | â‘  JSONè§£æ           |
     |                        | â‘¡ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä½œæˆ      |
     |                        | â‘¢ APIå©ã            |
     |                        | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> |
     |                        |                      |
     |                        | <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ |
     |                        | â‘£ çµæœã‚’è¿”ã™         |
     | <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ |                      |
     | â‘¡ response.json(å—ä¿¡)  |
```

| å‡¦ç† | æµã‚Œ                                                | å‡¦ç†ã‚’æ›¸ã„ã¦ã‚‹å ´æ‰€           |
| ---- | --------------------------------------------------- | ---------------------------- |
| é€ä¿¡ | state â†’ JSON â†’ fetch â†’ request                      | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ(handleSubmit) |
| å‡¦ç† | request â†’ è§£æ â†’ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ â†’ Gemini â†’ NextResponse | route.ts                     |
| å—ä¿¡ | response â†’ JSONè§£æ â†’ è¡¨ç¤º                          | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ(handleSubmit) |

## æœ€å¾Œ

ã“ã®è¨˜äº‹ã¯ã€è‡ªåˆ†ãŒGemini APIã¯ã‚ã‹ã‚‹ãŒã©ã†é€£æºã™ã‚‹ã‹ã§èº“ã„ãŸã¨ãã«å¿…è¦ã ã¨æ„Ÿã˜ãŸçŸ¥è­˜ã®ãƒã‚¤ãƒ³ãƒˆã‚’æ•´ç†ã—ãªãŒã‚‰æ›¸ãã¾ã—ãŸã€‚

**ã€Œãªã‚“ã¨ãªãå‹•ãã€ã‹ã‚‰ã€Œãªãœå‹•ãã‹ç†è§£ã™ã‚‹ã€ã«å¤‰ã‚ã‚‹ãã£ã‹ã‘**ã«ãªã‚Œã°å¬‰ã—ã„ã§ã™ã€‚

'ã„ã„ã­'ãã ã•ã‚‹ã¨ã€å­¦ç¿’ã®ãƒ¢ãƒãƒ™ãŒã‹ãªã‚Šä¸ŠãŒã‚‹ã®ã§ãã ã•ã„ï¼
